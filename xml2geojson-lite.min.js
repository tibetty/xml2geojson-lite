!function(){return function e(t,r,s){function o(i,a){if(!r[i]){if(!t[i]){var l="function"==typeof require&&require;if(!a&&l)return l(i,!0);if(n)return n(i,!0);var p=new Error("Cannot find module '"+i+"'");throw p.code="MODULE_NOT_FOUND",p}var d=r[i]={exports:{}};t[i][0].call(d.exports,function(e){return o(t[i][1][e]||e)},d,d.exports,e,t,r,s)}return r[i].exports}for(var n="function"==typeof require&&require,i=0;i<s.length;i++)o(s[i]);return o}}()({1:[function(require,module,exports){const XmlParser=require("./xmlparser.js");module.exports=((osm,opts)=>{let first=e=>e[0],last=e=>e[e.length-1],coordsToKey=e=>e.join(","),addToMap=(e,t,r)=>{let s=e[t];s?s.push(r):e[t]=[r]},removeFromMap=(e,t,r)=>{let s=e[t];s&&s.splice(s.indexOf(r),1)},getFirstFromMap=(e,t)=>{let r=e[t];return r&&r.length>0?r[0]:null};class Ways{constructor(){this.ways=[],this.firstMap={},this.lastMap={}}add(e){this.ways.push(e),addToMap(this.firstMap,coordsToKey(first(e)),e),addToMap(this.lastMap,coordsToKey(last(e)),e)}toRings(e){let t=e=>coordsToKey(first(e))===coordsToKey(last(e)),r=e=>e instanceof Array?e.map(r):parseFloat(e),s=(e,t,r)=>{t=t||0,r=r||1;let s=e.reduce((r,s,o)=>e[r][t]>s[t]?r:o,0),o=s<=0?e.length-1:s-1,n=s>=e.length-1?0:s+1,i=e[o][t],a=e[s][t],l=e[n][t],p=e[o][r],d=e[s][r];return(a-i)*(e[n][r]-p)-(l-i)*(d-p)<0?"clockwise":"counterclockwise"},o=[],n=null;for(;n=this.ways.shift();)if(removeFromMap(this.firstMap,coordsToKey(first(n)),n),removeFromMap(this.lastMap,coordsToKey(last(n)),n),t(n))s(n=r(n))!==e&&n.reverse(),o.push(n);else{let i=n,a=null;do{let n=coordsToKey(last(i)),l=!1;(a=getFirstFromMap(this.firstMap,n))||(a=getFirstFromMap(this.lastMap,n),l=!0),a&&(this.ways.splice(this.ways.indexOf(a),1),removeFromMap(this.firstMap,coordsToKey(first(a)),a),removeFromMap(this.lastMap,coordsToKey(last(a)),a),l&&(a.length>i.length&&([i,a]=[a,i]),a.reverse()),t(i=i.concat(a.slice(1)))&&(s(i=r(i))!==e&&i.reverse(),o.push(i)))}while(a)}return o}}let innerWays=new Ways,outerWays=new Ways,features=[],relProps={};const xmlParser=new XmlParser({progressive:!0});xmlParser.addListener('</osm.relation.member[$type==="way"&&$role==="inner"]>',node=>{with(node){let way=[];for(let innerNode of innerNodes)way.push([innerNode.$lon,innerNode.$lat]);innerWays.add(way)}}),xmlParser.addListener('</osm.relation.member[$type==="way"&&$role==="outer"]>',node=>{with(node){let way=[];for(let innerNode of innerNodes)way.push([innerNode.$lon,innerNode.$lat]);outerWays.add(way)}}),opts&&opts.allFeatures&&(xmlParser.addListener("<osm.relation>",e=>relProps.id="relation/"+e.$id),xmlParser.addListener("<osm.relation.bounds>",e=>relProps.bbox=[parseFloat(e.$minlon),parseFloat(e.$minlat),parseFloat(e.$maxlon),parseFloat(e.$maxlat)]),xmlParser.addListener("</osm.relation.tag>",e=>relProps[e.$k]=e.$v),xmlParser.addListener('</osm.relation.member[$type==="node"]>',node=>{with(node)features.push({type:"Feature",id:`node/${$ref}`,properties:{id:`node/${$ref}`,role:$role},geometry:{type:"Point",coordinates:[parseFloat($lon),parseFloat($lat)]}})})),xmlParser.parse(osm);let constructGeometry=(e,t)=>{let r=e.toRings("counterclockwise"),s=t.toRings("clockwise"),o=(e,t,r,s)=>{r=r||0,s=s||1;let o=!1;for(let n=0,i=t.length-1;n<t.length;i=n++)(t[n][r]<=e[r]&&e[r]<t[i][r]||t[i][r]<=e[r]&&e[r]<t[n][r])&&e[s]<(t[i][s]-t[n][s])*(e[r]-t[n][r])/(t[i][r]-t[n][r])+t[n][s]&&(o=!o);return o},n=[];for(let e in r)n[e]=[r[e]];let i=null;for(;i=s.shift();)for(let e in r)if(o(first(i),r[e])){n[e].push(i);break}return 1===n.length?{type:"Polygon",coordinates:n[0]}:{type:"MultiPolygon",coordinates:n}},geometry=constructGeometry(outerWays,innerWays);return opts&&opts.allFeatures?(features.unshift({type:"Feature",id:relProps.id,properties:relProps,geometry:geometry}),{type:"FeatureCollection",features:features}):geometry})},{"./xmlparser.js":2}],2:[function(e,t,r){t.exports=(()=>{function e(e){return null!=e.match(/^(.+?)\[(.+?)\]>$/g)}function t(e){let t=/^(.+?)\[(.+?)\]>$/g.exec(e);return t?{evt:t[1]+">",exp:t[2]}:{evt:e}}return class{constructor(e){e&&(this.queryParent=!!e.queryParent,this.progressive=e.progressive,this.queryParent&&(this.parentMap=new WeakMap)),this.evtListeners={}}parse(e,t,r){r=r?r+".":"";let s=/<([^ >\/]+)(.*?)>/gm,o=null,n=[];for(;o=s.exec(e);){let i=o[1],a={tag:i},l=r+i,p=o[2].trim(),d=!1;(p.endsWith("/")||i.startsWith("?")||i.startsWith("!"))&&(d=!0);let u=/([^ ]+?)="(.+?)"/g,h=null,c=!1;for(;h=u.exec(p);)c=!0,a[`$${h[1]}`]=h[2];if(c||""===p||(a.text=p),this.progressive&&this.emit(`<${l}>`,a,t),!d){let t=new RegExp(`([^]+?)</${i}>`,"g");t.lastIndex=s.lastIndex;let r=t.exec(e);if(r&&r[1]){s.lastIndex=t.lastIndex;let e=this.parse(r[1],a,l);e.length>0?a.innerNodes=e:a.innerText=r[1]}}this.queryParent&&t&&this.parentMap.set(a,t),this.progressive&&this.emit(`</${l}>`,a,t),n.push(a)}return n}getParent(e){return this.queryParent?this.parentMap.get(e):null}$addListener(e,t){let r=this.evtListeners[e];r?r.push(t):this.evtListeners[e]=[t]}addListener(r,s){e(r)&&(r=t(r),s.condition=function(e){let t="return "+e.replace(/(\$.+?)(?=[=!.])/g,"node.$&")+";";return new Function("node",t)}(r.exp),r=r.evt),this.$addListener(r,s)}$removeListener(e,t){let r=this.evtListeners[e];r&&r.splice(r.indexOf(t),1)}removeListener(r,s){e(r)&&(r=(r=t(r)).evt),this.$removeListener(r,s)}emit(e,...t){let r=this.evtListeners[e];if(r)for(let e of r)e.condition?!0===e.condition.apply(null,t)&&e.apply(null,t):e.apply(null,t)}on(e,t){this.addListener(e,t)}off(e,t){this.removeListener(e,t)}}})()},{}]},{},[1]);